!function(e,t){"use strict";function n(e,t){for(var n,r=[],i=0;i<e.length;++i){if(n=l[e[i]]||o(e[i]),!n)throw"module definition dependecy not found: "+e[i];r.push(n)}t.apply(null,r)}function r(e,r,o){if("string"!=typeof e)throw"invalid module definition, module id must be defined and be a string";if(r===t)throw"invalid module definition, dependencies must be specified";if(o===t)throw"invalid module definition, definition function must be specified";n(r,function(){l[e]=o.apply(null,arguments)})}function o(t){for(var n=e,r=t.split(/[.\/]/),o=0;o<r.length;++o){if(!n[r[o]])return;n=n[r[o]]}return n}function a(n){var r,o,i,a,s;for(r=0;r<n.length;r++){o=e,i=n[r],a=i.split(/[.\/]/);for(var c=0;c<a.length-1;++c)o[a[c]]===t&&(o[a[c]]={}),o=o[a[c]];o[a[a.length-1]]=l[i]}if(e.AMDLC_TESTS){s=e.privateModules||{};for(i in l)s[i]=l[i];for(r=0;r<n.length;r++)delete s[n[r]];e.privateModules=s}}var l={};r("tinymce/spellcheckerplugin/DomTextMatcher",[],function(){function e(e){return e&&1==e.nodeType&&"false"===e.contentEditable}return function(t,n){function r(e,t){if(!e[0])throw"findAndReplaceDOMText cannot handle zero-length matches";return{start:e.index,end:e.index+e[0].length,text:e[0],data:t}}function o(t){var n;if(3===t.nodeType)return t.data;if(b[t.nodeName]&&!N[t.nodeName])return"";if(e(t))return"\n";if(n="",(N[t.nodeName]||C[t.nodeName])&&(n+="\n"),t=t.firstChild)do n+=o(t);while(t=t.nextSibling);return n}function i(t,n,r){var o,i,a,l,s,c=[],d=0,u=t,p=0;n=n.slice(0),n.sort(function(e,t){return e.start-t.start}),s=n.shift();e:for(;;){if((N[u.nodeName]||C[u.nodeName]||e(u))&&d++,3===u.nodeType&&(!i&&u.length+d>=s.end?(i=u,l=s.end-d):o&&c.push(u),!o&&u.length+d>s.start&&(o=u,a=s.start-d),d+=u.length),o&&i){if(u=r({startNode:o,startNodeIndex:a,endNode:i,endNodeIndex:l,innerNodes:c,match:s.text,matchIndex:p}),d-=i.length-l,o=null,i=null,c=[],s=n.shift(),p++,!s)break}else if(b[u.nodeName]&&!N[u.nodeName]||!u.firstChild){if(u.nextSibling){u=u.nextSibling;continue}}else if(!e(u)){u=u.firstChild;continue}for(;;){if(u.nextSibling){u=u.nextSibling;break}if(u.parentNode===t)break e;u=u.parentNode}}}function a(e){function t(t,n){var r=E[n];r.stencil||(r.stencil=e(r));var o=r.stencil.cloneNode(!1);return o.setAttribute("data-mce-index",n),t&&o.appendChild(T.doc.createTextNode(t)),o}return function(e){var n,r,o,i=e.startNode,a=e.endNode,l=e.matchIndex,s=T.doc;if(i===a){var c=i;o=c.parentNode,e.startNodeIndex>0&&(n=s.createTextNode(c.data.substring(0,e.startNodeIndex)),o.insertBefore(n,c));var d=t(e.match,l);return o.insertBefore(d,c),e.endNodeIndex<c.length&&(r=s.createTextNode(c.data.substring(e.endNodeIndex)),o.insertBefore(r,c)),c.parentNode.removeChild(c),d}n=s.createTextNode(i.data.substring(0,e.startNodeIndex)),r=s.createTextNode(a.data.substring(e.endNodeIndex));for(var u=t(i.data.substring(e.startNodeIndex),l),p=[],h=0,f=e.innerNodes.length;f>h;++h){var g=e.innerNodes[h],m=t(g.data,l);g.parentNode.replaceChild(m,g),p.push(m)}var v=t(a.data.substring(0,e.endNodeIndex),l);return o=i.parentNode,o.insertBefore(n,i),o.insertBefore(u,i),o.removeChild(i),o=a.parentNode,o.insertBefore(v,a),o.insertBefore(r,a),o.removeChild(a),v}}function l(e){var t=e.parentNode;t.insertBefore(e.firstChild,e),e.parentNode.removeChild(e)}function s(e){var n=t.getElementsByTagName("*"),r=[];e="number"==typeof e?""+e:null;for(var o=0;o<n.length;o++){var i=n[o],a=i.getAttribute("data-mce-index");null!==a&&a.length&&(a!==e&&null!==e||r.push(i))}return r}function c(e){for(var t=E.length;t--;)if(E[t]===e)return t;return-1}function d(e){var t=[];return u(function(n,r){e(n,r)&&t.push(n)}),E=t,this}function u(e){for(var t=0,n=E.length;n>t&&e(E[t],t)!==!1;t++);return this}function p(e){return E.length&&i(t,E,a(e)),this}function h(e,t){if(w&&e.global)for(;S=e.exec(w);)E.push(r(S,t));return this}function f(e){var t,n=s(e?c(e):null);for(t=n.length;t--;)l(n[t]);return this}function g(e){return E[e.getAttribute("data-mce-index")]}function m(e){return s(c(e))[0]}function v(e,t,n){return E.push({start:e,end:e+t,text:w.substr(e,t),data:n}),this}function k(e){var t=s(c(e)),r=n.dom.createRng();return r.setStartBefore(t[0]),r.setEndAfter(t[t.length-1]),r}function y(e,t){var r=k(e);return r.deleteContents(),t.length>0&&r.insertNode(n.dom.doc.createTextNode(t)),r}function x(){return E.splice(0,E.length),f(),this}var S,w,N,b,C,E=[],T=n.dom;return N=n.schema.getBlockElements(),b=n.schema.getWhiteSpaceElements(),C=n.schema.getShortEndedElements(),w=o(t),{text:w,matches:E,each:u,filter:d,reset:x,matchFromElement:g,elementFromMatch:m,find:h,add:v,wrap:p,unwrap:f,replace:y,rangeFromMatch:k,indexOf:c}}}),r("tinymce/spellcheckerplugin/Plugin",["tinymce/spellcheckerplugin/DomTextMatcher","tinymce/PluginManager","tinymce/util/Tools","tinymce/ui/Menu","tinymce/dom/DOMUtils","tinymce/util/XHR","tinymce/util/URI","tinymce/util/JSON"],function(e,t,n,r,o,a,l,s){t.add("spellchecker",function(c,d){function u(){return $.textMatcher||($.textMatcher=new e(c.getBody(),c)),$.textMatcher}function p(e,t){var r=[];return n.each(t,function(e){r.push({selectable:!0,text:e.name,data:e.value})}),r}function h(e){for(var t in e)return!1;return!0}function f(e,t){var a=[],l=D[e],s=[],d=0;if(null!=l&&l.length>0)for(i=0;i<l.length;i++)null!=l[i]&&""!=l[i]&&(s[d]=l[i],d++);l=s,n.each(l,function(e){a.push({text:e,onclick:function(){c.insertContent(c.dom.encode(e)),c.dom.remove(t),w()}})}),a.push({text:"-"}),O&&a.push({text:"Add to Dictionary",onclick:function(){N(e,t)}}),a.push.apply(a,[{text:"Ignore",onclick:function(){b(e,t)}},{text:"Ignore all",onclick:function(){b(e,t,!0)}}]),L=new r({items:a,context:"contextmenu",onautohide:function(e){-1!=e.target.className.indexOf("spellchecker")&&e.preventDefault()},onhide:function(){L.remove(),L=null}}),L.renderTo(document.body);var u=o.DOM.getPos(c.getContentAreaContainer()),p=c.dom.getPos(t[0]),h=c.dom.getRoot();"BODY"==h.nodeName?(p.x-=h.ownerDocument.documentElement.scrollLeft||h.scrollLeft,p.y-=h.ownerDocument.documentElement.scrollTop||h.scrollTop):(p.x-=h.scrollLeft,p.y-=h.scrollTop),u.x+=p.x,u.y+=p.y,L.moveTo(u.x,u.y+t[0].offsetHeight)}function g(){return c.getParam("spellchecker_wordchar_pattern")||new RegExp('[^\\s!"#$%&()*+,-./:;<=>?@[\\]^_{|}`§©«®±¶·¸»¼½¾¿×÷¤”“„    ]+',"g")}function m(e,t,r,o){var i={method:e,lang:F.spellchecker_language},u="";i["addToDictionary"==e?"word":"text"]=t,n.each(i,function(e,t){u&&(u+="&"),u+=t+"="+encodeURIComponent(e)}),a.send({url:new l(d).toAbsolute(F.spellchecker_rpc_url),type:"post",content_type:"application/x-www-form-urlencoded",data:u,success:function(e){if(e=s.parse(e))e.error?o(e.error):r(e);else{var t=c.translate("Server response wasn't proper JSON.");o(t)}},error:function(){var e=c.translate("The spelling service was not found: (")+F.spellchecker_rpc_url+c.translate(")");o(e)}})}function v(e,t,n,r){var o=F.spellchecker_callback||m;o.call($,e,t,n,r)}function k(e,t){function n(e){$.formComponent.spellcheckOnEnterActive?c.windowManager.confirm(e+". Do you want to send anyway?",function(e){e?(c.setProgressState(!1),P=!1,R(!1)):($.formComponent.spellcheckOnEnterActive=!1,c.setProgressState(!1),C())}):(c.windowManager.alert(e),c.setProgressState(!1),C())}if(W=t,!C()){A(),c.setProgressState(!0);var r=u().text;F.spellchecker_ignore_content_links&&(r=y(r)),F.spellchecker_ignore_urls&&(r=x(r)),v("spellcheck",r,I,n),c.focus()}}function y(e){if(null==e)return e;var t=e.replace(new RegExp("(\\[\\[--ContentED.*?\\|\\|)(.*?)(\\|\\|KM.*?\\|\\|.*?--]])","mgi"),"$2");return t.replace(new RegExp("(\\[\\[--ContentED.*?\\|\\|)(.*?)(\\|\\|.*?\\|\\|DT.*?\\|\\|.*?--]])","mgi"),"$2")}function x(e){var t,n=S();for(t=0;t<n.length;t++)e=e.replace(n[t],"");return e}function S(){var e=[];return e.push(new RegExp("http://.+?(?= |$)","mgi")),e.push(new RegExp("https://.+?(?= |$)","mgi")),e.push(new RegExp("ftp://.+?(?= |$)","mgi")),e.push(new RegExp("ftps://.+?(?= |$)","mgi")),e.push(new RegExp("file://.+?(?= |$)","mgi")),e.push(new RegExp("www\\..+?(?= |$)","mgi")),e}function w(){c.dom.select("span.mce-spellchecker-word").length||C()}function N(e,t){c.setProgressState(!0),v("addToDictionary",e,function(){c.setProgressState(!1),c.dom.remove(t,!0),w()},function(e){c.windowManager.alert(e),c.setProgressState(!1)})}function b(e,t,r){c.selection.collapse(),r?n.each(c.dom.select("span.mce-spellchecker-word"),function(t){t.getAttribute("data-mce-word")==e&&c.dom.remove(t,!0)}):c.dom.remove(t,!0),w()}function C(){return u().reset(),$.textMatcher=null,P?(P=!1,c.fire("SpellcheckEnd"),!0):void 0}function E(e){var t=e.getAttribute("data-mce-index");return"number"==typeof t?""+t:t}function T(e){var t,r=[];if(t=n.toArray(c.getBody().getElementsByTagName("span")),t.length)for(var o=0;o<t.length;o++){var i=E(t[o]);null!==i&&i.length&&i===e.toString()&&r.push(t[o])}return r}function _(e){var t=F.spellchecker_language;e.control.items().each(function(e){e.active(e.settings.data===t)})}function I(e){var t,n=W&&W.suppressAlerts?W.suppressAlerts:!1,r=F.spellchecker_use_wizard;if(e.words?(O=r?F.spellchecker_enable_learn_rpc:!!e.dictionary,t=e.words):t=e,c.setProgressState(!1),h(t)){if(!n){var o=c.translate("No misspellings found.");c.windowManager.alert(o)}return P=!1,void R(!1)}D=t,u().find(g()).filter(function(e){return!!t[e.text]}).wrap(function(e){return c.dom.create("span",{"class":"mce-spellchecker-word","data-mce-bogus":1,"data-mce-word":e.text})}),r&&M(),P=!0,c.fire("SpellcheckStart")}function M(){function e(t,n){for(var r=0;r<t.childNodes.length;r++){var o=t.childNodes[r];"#text"===o.nodeName?n.call(this,o):e(o,n)}}function t(){var e=new r;e.doPopup()}var r=function(){this.language="",this.selectedLang="",this.languages="",this.editor=c,this.useSpellcheckWizard=F.spellchecker_use_wizard,this.allowAddToDictionary=F.spellchecker_enable_learn_rpc,this.ignoredElementTags="abbr,em,strong,b,i,u,small,s,big,strike,tt,font,span,sub,sup",this.ignoredElementTags=this.ignoredElementTags.split(","),Array.prototype.indexOf||(this.ignoredElementTags.indexOf=function(e){for(var t=0;t<this.length;++t)if(this[t]===e)return t;return-1}),this.wordSeparatorChars=c.getParam("spellchecker_wordchar"),this.suggestions=D};r.prototype.getLanguages=function(){var e={},t=F.spellchecker_languages.split(",");for(i=0;i<t.length;i++){var n;"+"==t[i].charAt(0)?(n=t[i].replace("+","").split("="),this.selectedLang=n[1]):n=t[i].split("="),e[n[0]]=n[1]}return e},r.prototype.toMap=function(e){var t,n={};for(t=0;t<e.length;t++){var r=e[t];n[r]=!0}return n},r.prototype.getArraySuggestions=function(){var e=[],t=0;for(var n in this.suggestions)e[t]=n,t++;return e},r.prototype.getSeparators=function(){var e,t="",n=this.wordSeparatorChars;for(e=0;e<n.length;e++)t+="\\"+n.charAt(e);return t},r.prototype.done=function(){C()},r.prototype.walk=function(t,n){var r,o=this.editor.getDoc();if("8"===this.editor.editorManager.isIE)return void e(t,n);if(o.createTreeWalker)for(r=o.createTreeWalker(t,NodeFilter.SHOW_ALL,null,!1);null!=(t=r.nextNode());)n.call(this,t);else this.walk(t,n,"childNodes")},r.prototype.getMisspelledNodes=function(){var e=this.editor,t=e.dom,n=(t.createRng(),[]);return this.walk(e.getBody(),function(e){3==e.nodeType&&e.parentNode&&t.hasClass(e.parentNode,"mce-spellchecker-word")&&n.push(e)}),n},r.prototype.stripOutSeparator=function(e){return e.replace(new RegExp("([0-9]|["+this.getSeparators()+"])","g")," ")},r.prototype.getPrevNode=function(e){if(e.previousSibling){for(e=e.previousSibling;e&&e.lastChild;)e=e.lastChild;return e}return e.parentNode},r.prototype.getNextNode=function(e){if(e.firstChild)return e.firstChild;for(;e&&!e.nextSibling;)e=e.parentNode;return e?e.nextSibling:e},r.prototype.isInIgnoredElement=function(e){return 1==e.nodeType&&-1!=this.ignoredElementTags.indexOf(e.nodeName.toLowerCase())||1!=e.nodeType},r.prototype.findLastWord=function(e,t){var n,r,o,i,a=!1;if(3==e.nodeType){if(n=this.stripOutSeparator(e.nodeValue).match(/\S+$/),null!=n)for(n=n[0],t&&t.setEnd(e,n.length);(e=this.getNextNode(e))&&!a;)3==e.nodeType&&e.nodeValue.length>0?(o=this.stripOutSeparator(e.nodeValue),(r=o.match(/^\S+/))&&(o.match(/^\S+\s/)?(n+=r[0],t&&t.setEnd(e,r[0].length)):n+=this.findLastWord(e,t)),a=!0):this.isInIgnoredElement(e)?(i=e.previousSibling)&&(this.isInIgnoredElement(i)||(a=!0)):a=!0;return n}return e.firstChild?this.findLastWord(e.firstChild,t):null},r.prototype.findFirstWord=function(e,t){var n,r,o,i,a=this,l=!1;if(3==e.nodeType){if(i=e,n=this.stripOutSeparator(e.nodeValue),r=n.match(/^\S+/))for(r=r[0];this.getPrevNode(e)!=a.editor.getBody();){if((o=e.previousSibling)&&(this.isInIgnoredElement(o)||(l=!0)),!l)if(e=this.getPrevNode(e),3==e.nodeType&&e.nodeValue.length>0)if(n=this.stripOutSeparator(e.nodeValue),n.match(/\S+$/)){if(n.match(/\s\S+$/))return t&&t.setStart(e,n.length-n.match(/\s\S+$/)[0].length),this.findLastWord(e,t);i=e}else l=!0;else this.isInIgnoredElement(e)||(l=!0);if(l)return e=i,n=this.stripOutSeparator(e.nodeValue),t&&t.setStart(e,0),n.match(/^\S+\s/)?n.match(/^\S+/):this.findLastWord(e,t)}return t.setStart(i,0),r}return e.firstChild?this.findFirstWord(e.firstChild,t):null},r.prototype.findWord=function(e,t){return this.findFirstWord(e,t)},r.prototype.getSuggestions=function(e){var t=D[e];return t},r.prototype.getMisspelledSpans=function(){var e=c.getBody().getElementsByTagName("span");return e},r.prototype.getSpanByWord=function(e){var t=c.getBody().getElementsByTagName("span"),n=[],r=0;for(i=0;i<t.length;i++){var o=t[i].getAttribute("data-mce-word");o==e&&(n[r++]=t[i])}return n},r.prototype.learnWord=function(e,t){var n=this.getSpanByWord(t);N(t,n)},r.prototype.checkForMissSpellingsAndCallSpellcheckCompleteCallback=function(){var e=c,t=e.dom,r=!1;n.each(t.select("span"),function(e){e&&t.hasClass(e,"mce-spellchecker-word")&&(r=!0)}),R(r)},r.prototype.stripRemainingSpans=function(){n.each(c.dom.select("span.mce-spellchecker-word"),function(e){c.dom.remove(e,!0)})},r.prototype.doPopup=function(){var e=this,t=e.editor;e.languages=e.getLanguages(),e.selectedLang=F.spellchecker_language,e.language=F.spellchecker_language,t.toolbarClicked=!0;var n={scope:e,func:e.done};t.windowManager.open({url:t.baseURI.source+"/plugins/spellchecker/spellcheckwizard.htm",width:352+parseInt(t.getLang("spellcheck.delta_width",0),10),height:366+parseInt(t.getLang("spellcheck.delta_height",0),10),inline:1,onClose:function(){e.stripRemainingSpans()}},{plugin_url:t.baseURI.source+"/plugins/spellchecker",plugin:e,selectedLang:e.selectedLang,wordNodes:e.getMisspelledNodes(),misspelledWords:e.toMap(e.getArraySuggestions()),callback:n,allowAddToDictionary:e.allowAddToDictionary,mce_auto_focus:!0})},t()}function A(){$.formComponent&&$.formComponent.spellcheckStartHandler&&$.formComponent.spellcheckStartHandler()}function R(e){$.formComponent&&$.formComponent.spellcheckCompleteHandler&&$.formComponent.spellcheckCompleteHandler(e)}var B,D,P,L,O,W,$=this,F=c.settings;if(/(^|[ ,])tinymcespellchecker([, ]|$)/.test(F.plugins)&&t.get("tinymcespellchecker"))return void("undefined"!=typeof console&&console.log&&console.log("Spell Checker Pro is incompatible with Spell Checker plugin! Remove 'spellchecker' from the 'plugins' option."));var H=F.spellchecker_languages||"English=en,Danish=da,Dutch=nl,Finnish=fi,French=fr_FR,German=de,Italian=it,Polish=pl,Portuguese=pt_BR,Spanish=es,Swedish=sv";B=p("Language",n.map(H.split(","),function(e){return e=e.split("="),{name:e[0],value:e[1]}})),c.on("click",function(e){var t=e.target;if("mce-spellchecker-word"==t.className){e.preventDefault();var n=T(E(t));if(n.length>0){var r=c.dom.createRng();r.setStartBefore(n[0]),r.setEndAfter(n[n.length-1]),c.selection.setRng(r),f(t.getAttribute("data-mce-word"),n)}}}),c.addMenuItem("spellchecker",{text:"Spellcheck",context:"tools",onclick:k,selectable:!0,onPostRender:function(){var e=this;e.active(P),c.on("SpellcheckStart SpellcheckEnd",function(){e.active(P)})}});var V={tooltip:"Spellcheck",onclick:k,onPostRender:function(){var e=this;c.on("SpellcheckStart SpellcheckEnd",function(){e.active(P)})}};B.length>1&&(V.type="splitbutton",V.menu=B,V.onshow=_,V.onselect=function(e){F.spellchecker_language=e.control.settings.data}),c.addButton("spellchecker",V),c.addCommand("mceSpellCheck",k),c.on("remove",function(){L&&(L.remove(),L=null)}),c.on("change",w),this.getTextMatcher=u,this.getWordCharPattern=g,this.markErrors=I,this.getLanguage=function(){return F.spellchecker_language},F.spellchecker_language=F.spellchecker_language||F.language||"en",$.formComponent=F.form_component})}),a(["tinymce/spellcheckerplugin/DomTextMatcher"])}(this);